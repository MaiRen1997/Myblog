---
title: time模块的使用
date: 2026-01-23 09:05:08
permalink: /pages/5d2b2f/
categories:
  - 后端
  - Python学习
  - 第三方库的使用
tags:
  - 
author: 
  name: Riverside Joy
  link: https://github.com/MaiRen1997
---
## 使用场景说明

1. **需要计时、休眠、简单时间戳时用time**
2. 以下API仅供参考

## 时间获取

### 获取时间戳(自1970年1月1日以来的秒数)

```python
import time

# 获取当前时间戳（浮点数，秒）
timestamp = time.time()
print(f"当前时间戳: {timestamp}")
# 例如：1708589647.123456
```

### 获取结构化时间

#### 获取当地时间

```python
local_time = time.localtime()
```

#### 年、月、日、时、分、秒

1. 月份是从1开始的，月js不同

2. ```python
   # 获取当前时间的 struct_time 对象（本地时间）
   local_time = time.localtime()
   print(f"本地时间: {local_time}")
   print(f"年份: {local_time.tm_year}")
   print(f"月份: {local_time.tm_mon}")
   print(f"日: {local_time.tm_mday}")
   print(f"小时: {local_time.tm_hour}")
   print(f"分钟: {local_time.tm_min}")
   print(f"秒: {local_time.tm_sec}")
   ```

#### 星期几

1. 值为0-6，0表示周一

2. ```python
   local_time = time.localtime()
   print(f"星期几: {local_time.tm_wday}")  # 0-6，0表示周一
   ```

#### 一年中的第几天

```python
local_time = time.localtime()
print(f"一年中的第几天: {local_time.tm_yday}")
```

#### 是否夏令时

```python
local_time = time.localtime()
print(f"是否夏令时: {local_time.tm_isdst}")
```

#### 获取UTC时间

```python
# 获取 UTC 时间的 struct_time 对象
utc_time = time.gmtime()
print(f"UTC 时间: {utc_time}")
```

#### 格式总结

```python
# struct_time 有9个属性
time_obj = time.localtime()
print(f"索引 | 属性 | 值 | 范围")
print("-" * 30)
print(f"0  | tm_year  | {time_obj.tm_year} | 年份，如 2024")
print(f"1  | tm_mon   | {time_obj.tm_mon}  | 月份 [1, 12]")
print(f"2  | tm_mday  | {time_obj.tm_mday} | 日 [1, 31]")
print(f"3  | tm_hour  | {time_obj.tm_hour} | 小时 [0, 23]")
print(f"4  | tm_min   | {time_obj.tm_min}  | 分钟 [0, 59]")
print(f"5  | tm_sec   | {time_obj.tm_sec}  | 秒 [0, 61]，60和61用于闰秒")
print(f"6  | tm_wday  | {time_obj.tm_wday} | 星期几 [0, 6]，0表示周一")
print(f"7  | tm_yday  | {time_obj.tm_yday} | 一年中的第几天 [1, 366]")
print(f"8  | tm_isdst | {time_obj.tm_isdst} | 夏令时标志：-1未知，0不是，1是")
```

### 字符串转换为时间

```python
# 将字符串解析为 struct_time
time_str = "2024-02-22 15:30:45"
time_obj = time.strptime(time_str, "%Y-%m-%d %H:%M:%S")
print(f"解析后的时间对象: {time_obj}")
print(f"年份: {time_obj.tm_year}, 月份: {time_obj.tm_mon}")
```

## 常用格式说明

| 代码 | 含义                                    | 示例     |
| :--- | :-------------------------------------- | :------- |
| `%Y` | 四位数的年份                            | 2024     |
| `%y` | 两位数的年份                            | 24       |
| `%m` | 月份（01-12）                           | 02       |
| `%d` | 日（01-31）                             | 22       |
| `%H` | 24小时制小时（00-23）                   | 15       |
| `%I` | 12小时制小时（01-12）                   | 03       |
| `%M` | 分钟（00-59）                           | 30       |
| `%S` | 秒（00-59）                             | 45       |
| `%p` | AM/PM                                   | PM       |
| `%A` | 完整的星期名称                          | Thursday |
| `%a` | 简写的星期名称                          | Thu      |
| `%B` | 完整的月份名称                          | February |
| `%b` | 简写的月份名称                          | Feb      |
| `%w` | 星期几（0-6，0是周日）                  | 4        |
| `%j` | 一年中的第几天（001-366）               | 053      |
| `%U` | 一年中的第几周（00-53，周日为一周开始） | 08       |
| `%W` | 一年中的第几周（00-53，周一为一周开始） | 08       |

## 时间转换

###  时间戳和 struct_time 互转

```python
# 时间戳 -> struct_time
timestamp = time.time()
time_obj = time.localtime(timestamp)  # 本地时间
utc_obj = time.gmtime(timestamp)     # UTC时间

# struct_time -> 时间戳
time_obj = time.localtime()
timestamp = time.mktime(time_obj)  # 注意：mktime 接受本地时间
print(f"转换后的时间戳: {timestamp}")
```

###  时间元组（9个元素的元组）

1. 使用mktime关键字

2. ```python
   # 创建时间元组（和 struct_time 类似但更轻量）
   # 格式：(年, 月, 日, 时, 分, 秒, 星期几, 一年中第几天, 夏令时标志)
   time_tuple = (2024, 2, 22, 15, 30, 45, 3, 53, 0)
   
   # 使用时间元组创建时间戳
   timestamp = time.mktime(time_tuple)
   print(f"时间元组转换的时间戳: {timestamp}")
   ```

## 程序控制

### 暂停执行(休眠)

1. 使用time.sleep()函数

2. ```python
   print("开始执行...")
   time.sleep(1)  # 暂停1秒
   print("1秒后...")
   time.sleep(0.5)  # 暂停0.5秒
   print("又过了0.5秒...")
   
   # 精确到纳秒的休眠（Python 3.11+）
   # time.sleep(1.5)  # 精确到秒
   ```

### 性能测量

```python
# 测量代码执行时间
start_time = time.perf_counter()  # 高精度计时器

# 执行一些代码
total = 0
for i in range(1000000):
    total += i

end_time = time.perf_counter()
elapsed = end_time - start_time
print(f"代码执行时间: {elapsed:.6f} 秒")

# 其他计时函数
print(f"time() 精度: {time.time()}")
print(f"perf_counter() 精度: {time.perf_counter()}")
print(f"monotonic() 精度: {time.monotonic()}")  # 保证单调递增
print(f"process_time() 精度: {time.process_time()}")  # 进程时间
```

## 其他函数

### 获取时区信息

#### 获取时区名称元组

```python
timezone_name = time.tzname  # 时区名称元组
print(f"时区名称: {timezone_name}")  # 例如：('中国标准时间', '中国夏令时')
```

#### 获取时区偏移

```python
timezone_offset = time.timezone  # 本地时区偏移（秒，UTC西时区为正）
print(f"时区偏移: {timezone_offset} 秒")
```

#### 是否使用夏令时

```python
daylight = time.daylight  # 是否使用夏令时
print(f"是否使用夏令时: {daylight}")
```

### 获取单调时间

#### 获取单调时间

1. monotonic() 返回单调递增的时间，不受系统时间调整影响

2. ```python
   # monotonic() 返回单调递增的时间，不受系统时间调整影响
   mono_time = time.monotonic()
   print(f"单调时间: {mono_time}")
   ```

#### 计算时间间隔

```python
# 计算时间间隔
start = time.monotonic()
time.sleep(1)
end = time.monotonic()
print(f"实际经过时间: {end - start:.6f} 秒")
```

## 实际应用

### 计算程序运行时间

```python
def measure_time(func):
    """装饰器：测量函数执行时间"""
    def wrapper(*args, **kwargs):
        start = time.perf_counter()
        result = func(*args, **kwargs)
        end = time.perf_counter()
        print(f"函数 {func.__name__} 执行时间: {end - start:.6f} 秒")
        return result
    return wrapper

@measure_time
def long_running_task(n):
    total = 0
    for i in range(n):
        total += i
    return total

result = long_running_task(1000000)
```

### 实现倒计时

```python
def countdown(seconds):
    """倒计时函数"""
    for i in range(seconds, 0, -1):
        print(f"\r倒计时: {i} 秒", end="")
        time.sleep(1)
    print("\r倒计时结束！     ")

# countdown(10)
```

### 生成时间戳文件名

```python
import time

def generate_filename(prefix="file"):
    """生成带时间戳的文件名"""
    timestamp = time.strftime("%Y%m%d_%H%M%S")
    return f"{prefix}_{timestamp}.txt"

filename = generate_filename("data")
print(f"生成的文件名: {filename}")  # data_20240222_153045.txt
```

### 时间计算

```python
# 计算未来时间
def future_time(days=0, hours=0, minutes=0, seconds=0):
    """计算未来时间"""
    now = time.time()
    future = now + (days*24*60*60) + (hours*60*60) + (minutes*60) + seconds
    return time.localtime(future)

# 7天后的时间
next_week = future_time(days=7)
print(f"7天后: {time.strftime('%Y-%m-%d %H:%M:%S', next_week)}")
```

### 时区转换

```python
def convert_timezone(timestamp, from_offset=0, to_offset=0):
    """简单时区转换"""
    return timestamp + (to_offset - from_offset)

# 示例：UTC+8 转到 UTC+0
local_time = time.time()
utc_time = convert_timezone(local_time, from_offset=8*3600, to_offset=0)
print(f"本地时间: {time.ctime(local_time)}")
print(f"UTC 时间: {time.ctime(utc_time)}")
```

## 快速参考表

| 函数             | 说明                     | 示例                                      |
| :--------------- | :----------------------- | :---------------------------------------- |
| `time()`         | 当前时间戳               | `time.time()`                             |
| `localtime()`    | 本地时间的 struct_time   | `time.localtime()`                        |
| `gmtime()`       | UTC时间的 struct_time    | `time.gmtime()`                           |
| `strftime()`     | 格式化时间               | `time.strftime("%Y-%m-%d")`               |
| `strptime()`     | 解析字符串为时间         | `time.strptime("2024-02-22", "%Y-%m-%d")` |
| `mktime()`       | struct_time 转时间戳     | `time.mktime(time.localtime())`           |
| `sleep()`        | 暂停执行                 | `time.sleep(1)`                           |
| `perf_counter()` | 高精度计时器             | `time.perf_counter()`                     |
| `ctime()`        | 时间戳转可读字符串       | `time.ctime()`                            |
| `asctime()`      | struct_time 转可读字符串 | `time.asctime()`                          |
| `tzname`         | 时区名称                 | `time.tzname`                             |
| `timezone`       | 时区偏移                 | `time.timezone`                           |



