---
title: f-string的使用
date: 2025-12-22 09:40:40
permalink: /pages/d0306d/
categories:
  - 后端
  - Python学习
  - Python基础
tags:
  - 
author: 
  name: Riverside Joy
  link: https://github.com/MaiRen1997
---
## 基础语法

### 使用变量

#### 字符串拼接

- ```python
  name = "Alice"
  age = 25
  
  # 基本用法
  message = f"My name is {name} and I'm {age} years old."
  print(message)  # My name is Alice and I'm 25 years old
  ```

#### 直接在print使用

- ```python
  name = "Alice"
  age = 25
  # 在 print 中直接使用
  print(f"Hello, {name}!")
  ```

#### 单行、多行字符串

1. 单行字符串

   1. 使用单引号

      - ```python
        # 单引号
        f'Name: {name}'
        ```

   2. 使用双引号

      - ```python
        # 双引号
        f"Name: {name}"
        ```

2. 多行字符串-使用三引号

   - ```python
     # 三引号（多行字符串）
     message = f"""
     User Information:
       Name: {name}
       Age: {age}
     """
     print(message)
     ```

## 括号内可用类型

### 变量

- ```python
  # 单引号
  f'Name: {name}'
  ```

### 表达式

- ```python
  x = 10
  y = 20
  print(f"x + y = {x + y}")      # x + y = 30
  print(f"x * y = {x * y}")      # x * y = 200
  print(f"x^2 = {x ** 2}")       # x^2 = 100
  ```

### 方法和API

- ```python
  name = "python"
  print(f"Uppercase: {name.upper()}")          # UPPERCASE: PYTHON
  print(f"Capitalize: {name.capitalize()}")    # Capitalize: Python
  print(f"Length: {len(name)}")                # Length: 6
  
  import math
  print(f"π = {math.pi:.3f}")                  # π = 3.142
  print(f"√2 = {math.sqrt(2):.4f}")            # √2 = 1.4142
  ```

### 复杂类型的操作API

- ```python
  # 列表操作
  items = ['apple', 'banana', 'cherry']
  print(f"First item: {items[0]}")             # First item: apple
  print(f"Last item: {items[-1]}")             # Last item: cherry
  print(f"Items count: {len(items)}")          # Items count: 3
  
  # 字典操作
  person = {'name': 'Bob', 'age': 30}
  print(f"Name: {person['name']}")             # Name: Bob
  print(f"Age: {person.get('age')}")           # Age: 30
  
  # 条件表达式
  score = 85
  print(f"Grade: {'Pass' if score >= 60 else 'Fail'}")  # Grade: Pass
  ```

## 格式说明符

### 小数格式化

1. 保留小数位

   1. 使用`:.数字f`的格式，保留小数位

   2. ```python
      num = 123.456789
      
      # 小数位数
      print(f"{num:.2f}")      # 123.46
      print(f"{num:.0f}")      # 123
      print(f"{num:.4f}")      # 123.4568
      ```

2. 指定宽度并对其

   1. 使用  :`方向  宽度`.数字f    的格式,定义宽度和对齐方式

   2. ```python
      # 宽度和对齐
      print(f"{num:10.2f}")    # '    123.46' - 总宽度10
      print(f"{num:<10.2f}")   # '123.46    ' - 左对齐
      print(f"{num:>10.2f}")   # '    123.46' - 右对齐
      print(f"{num:^10.2f}")   # '  123.46  ' - 居中对齐
      ```

3. 指定对其填充字符

   1. 在第条基础上，在方向前面指定字符，可以指定补齐所需的字符，格式,使用  :`指定字符  方向  宽度`.数字f  

   2. ```python
      # 填充字符
      print(f"{num:*>10.2f}")  # ****123.46
      print(f"{num:=^10.2f}")  # ==123.46==
      ```

### 字符串格式化

```python
text = "hello"

# 对齐
print(f"|{text:<10}|")    # |hello     |
print(f"|{text:>10}|")    # |     hello|
print(f"|{text:^10}|")    # |  hello   |

# 填充
print(f"{text:*<10}")     # hello*****
print(f"{text:*>10}")     # *****hello
print(f"{text:*^10}")     # **hello***

# 截断
long_text = "Hello, World!"
print(f"{long_text:.5}")  # Hello
```

### 进制格式化

#### 格式化进制

1. 格式

   1. 十进制，什么都不填
   2. 二进制，:b
   3. 八进制，:o
   4. 十六进制，:x
   5. 大写十六进制，:X

2. 示例

   ```python
   n = 42
   # 进制转换
   print(f"Decimal: {n}")       # 42
   print(f"Binary: {n:b}")      # 101010
   print(f"Octal: {n:o}")       # 52
   print(f"Hex (lower): {n:x}") # 2a
   print(f"Hex (upper): {n:X}") # 2A
   ```

#### 进制带前缀

1. 使用#号即可

2. ```python
   # 带前缀
   print(f"Hex with 0x: {n:#x}")   # 0x2a
   print(f"Binary with 0b: {n:#b}") # 0b101010
   ```

#### 指定宽度和前导0

1. ```python
   # 宽度和前导0
   print(f"{n:04d}")    # 0042
   print(f"{n:08b}")    # 00101010
   ```

### 特殊格式

#### 千位分隔符

1. 使用`:,`

2. ```python
   # 千位分隔符
   big_num = 1234567.89
   print(f"{big_num:,}")           # 1,234,567.89
   print(f"{big_num:,.2f}")        # 1,234,567.89
   ```

#### 百分比

1. 使用`:. 保留位数   %`

2. ```python
   # 百分比
   ratio = 0.756
   print(f"{ratio:.1%}")           # 75.6%
   print(f"{ratio:.2%}")           # 75.60%
   ```

#### 科学计数法

1. ```python
   # 科学计数法
   small_num = 0.000123456
   print(f"{small_num:.2e}")       # 1.23e-04
   print(f"{small_num:.4E}")       # 1.2346E-04
   ```

#### 正负号显示

1. 使用  :+ 显示符号

2. ```python
   # 正负号显示
   temp = -5
   print(f"{temp:+}°C")            # -5°C
   temp = 20
   print(f"{temp:+}°C")            # +20°C
   ```

## 高级用法

### 嵌套花括号

```python
# 显示花括号本身
print(f"{{This is in braces}}")      # {This is in braces}

# 嵌套格式化
width = 10
precision = 2
value = 12.34567
print(f"{value:{width}.{precision}f}")  # '     12.35'
```

### 时间日期格式化

#### 格式化方式

1. 年、月、日相关

   - | 占位符       | 含义                 | 示例输出 | 说明             |
     | :----------- | :------------------- | :------- | :--------------- |
     | `%Y`         | 四位数年份           | `2024`   | 完整年份         |
     | `%y`         | 两位数年份           | `24`     | 年份后两位       |
     | `%m`         | 月份（两位数）       | `08`     | 01-12            |
     | `%B`         | 完整月份名称         | `August` | 本地化完整月份名 |
     | `%b` 或 `%h` | 缩写月份名称         | `Aug`    | 本地化缩写月份名 |
     | `%d`         | 月份中的日（两位数） | `15`     | 01-31            |
     | `%j`         | 年份中的第几天       | `228`    | 001-366          |

2. 星期相关

   - | 占位符 | 含义                         | 示例输出   | 说明             |
     | :----- | :--------------------------- | :--------- | :--------------- |
     | `%A`   | 完整星期名称                 | `Thursday` | 本地化完整星期名 |
     | `%a`   | 缩写星期名称                 | `Thu`      | 本地化缩写星期名 |
     | `%w`   | 数字星期                     | `4`        | 0(周日)-6(周六)  |
     | `%U`   | 一年中的第几周（周日为周始） | `33`       | 00-53            |
     | `%W`   | 一年中的第几周（周一为周始） | `33`       | 00-53            |

3. 时间相关

   - | 占位符 | 含义                   | 示例输出 | 说明            |
     | :----- | :--------------------- | :------- | :-------------- |
     | `%H`   | 24小时制小时（两位数） | `14`     | 00-23           |
     | `%I`   | 12小时制小时（两位数） | `02`     | 01-12           |
     | `%p`   | AM/PM                  | `PM`     | 本地化上午/下午 |
     | `%M`   | 分钟（两位数）         | `05`     | 00-59           |
     | `%S`   | 秒（两位数）           | `09`     | 00-59           |
     | `%f`   | 微秒（六位数）         | `123456` | 000000-999999   |

4. 其他常用占位符

   - | 占位符 | 含义               | 示例输出                   | 说明         |
     | :----- | :----------------- | :------------------------- | :----------- |
     | `%c`   | 本地化的日期和时间 | `Thu Aug 15 14:05:09 2024` | 完整日期时间 |
     | `%x`   | 本地化的日期表示   | `08/15/24`                 | 日期部分     |
     | `%X`   | 本地化的时间表示   | `14:05:09`                 | 时间部分     |
     | `%z`   | UTC 偏移量         | `+0800`                    | 时区偏移     |
     | `%Z`   | 时区名称           | `CST`                      | 时区名       |
     | `%%`   | 百分号             | `%`                        | 字面百分号   |

#### 代码示例

- ```python
  from datetime import datetime
  
  now = datetime.now()
  print(f"Date: {now:%Y-%m-%d}")        # Date: 2024-01-15
  print(f"Time: {now:%H:%M:%S}")        # Time: 14:30:45
  print(f"Full: {now:%Y-%m-%d %H:%M:%S}")  # Full: 2024-01-15 14:30:45
  
  # 常用格式
  print(f"{now:%A, %B %d, %Y}")        # Monday, January 15, 2024
  print(f"{now:%I:%M %p}")             # 02:30 PM
  ```

### 调用自定义函数

```python
def get_greeting(name):
    return f"Hello, {name}!"

name = "Alice"
print(f"{get_greeting(name)}")       # Hello, Alice!

# 直接在 f-string 中调用
print(f"{'python'.upper()}")         # PYTHON
```

### 调试输出(python3.8+)

```python
x = 10
y = 20

# 使用 = 可以同时显示变量名和值
print(f"{x=}, {y=}")                 # x=10, y=20
print(f"{x + y = }")                 # x + y = 30
print(f"{x * y = :,}")               # x * y = 200

# 在表达式中使用
data = [1, 2, 3, 4, 5]
print(f"{len(data) = }")             # len(data) = 5
print(f"{sum(data) = }")             # sum(data) = 15
```

## 实用示例

### 表格输出

```python
employees = [
    ("Alice", "Engineering", 75000, 85.5),
    ("Bob", "Marketing", 65000, 92.3),
    ("Charlie", "Sales", 82000, 78.9),
    ("Diana", "HR", 58000, 95.1)
]

# 表头
print(f"{'Name':<10} {'Department':<15} {'Salary':>10} {'Score':>8}")
print("-" * 50)

# 数据行
for name, dept, salary, score in employees:
    print(f"{name:<10} {dept:<15} ${salary:>9,} {score:>7.1f}%")

# 输出：
# Name       Department       Salary   Score
# --------------------------------------------------
# Alice      Engineering      $75,000    85.5%
# Bob        Marketing        $65,000    92.3%
# Charlie    Sales            $82,000    78.9%
# Diana      HR               $58,000    95.1%
```

### 进度条显示

```python
def show_progress(current, total):
    percent = (current / total) * 100
    bar_length = 30
    filled_length = int(bar_length * current // total)
    bar = '█' * filled_length + '-' * (bar_length - filled_length)
    
    print(f"\rProgress: |{bar}| {percent:.1f}% ({current}/{total})", end='')

# 使用示例
import time
total = 100
for i in range(total + 1):
    show_progress(i, total)
    time.sleep(0.05)
print()  # 换行
```

### 数据报告

```python
data = {
    'revenue': 1500000,
    'expenses': 850000,
    'profit': 650000,
    'growth_rate': 0.15
}

print("Financial Report")
print("=" * 40)
print(f"Revenue:      ${data['revenue']:>13,}")
print(f"Expenses:     ${data['expenses']:>13,}")
print(f"Profit:       ${data['profit']:>13,}")
print(f"Growth Rate:  {data['growth_rate']:>13.1%}")
print("=" * 40)

# 输出：
# Financial Report
# ========================================
# Revenue:      $  1,500,000
# Expenses:     $    850,000
# Profit:       $    650,000
# Growth Rate:           15.0%
```

### 数学公式显示

```python
import math

a, b = 3, 4
c = math.sqrt(a**2 + b**2)

print(f"Pythagorean Theorem:")
print(f"a = {a}, b = {b}")
print(f"c = √({a}² + {b}²) = √({a**2} + {b**2}) = √{a**2 + b**2} = {c:.2f}")
```

## 注意事项和技巧

### 转义字符

```python
# 不能在 f-string 中使用反斜杠转义
# 错误：print(f"{\n}")  # SyntaxError

# 正确做法：
print(f"{{newline}}")  # 显示 {newline}
newline = "\n"
print(f"Line1{newline}Line2")  # 使用变量
```

### 性能考虑

```python
import timeit

# f-string 最快
code1 = '''
name = "Alice"
age = 25
f"My name is {name} and I'm {age} years old."
'''

code2 = '''
name = "Alice"
age = 25
"My name is {} and I'm {} years old.".format(name, age)
'''

code3 = '''
name = "Alice"
age = 25
"My name is %s and I'm %d years old." % (name, age)
'''

print("f-string:", timeit.timeit(code1, number=1000000))
print("format():", timeit.timeit(code2, number=1000000))
print("% format:", timeit.timeit(code3, number=1000000))
```

### 复杂表达式分行

```python
# 使用括号多行编写
result = (
    f"Detailed Analysis:\n"
    f"  Total Items: {len(items)}\n"
    f"  Average: {sum(items)/len(items):.2f}\n"
    f"  Max: {max(items)}\n"
    f"  Min: {min(items)}"
)
```

### 条件格式化

```python
temperature = 25
status = "normal"

print(f"Temperature: {temperature}°C - Status: {status}")

# 根据条件改变颜色（终端中显示）
color = "\033[91m" if temperature > 30 else "\033[92m"  # 红色或绿色
reset = "\033[0m"
print(f"Temperature: {color}{temperature}°C{reset}")
```

















