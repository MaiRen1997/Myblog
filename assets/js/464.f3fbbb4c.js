(window.webpackJsonp=window.webpackJsonp||[]).push([[464],{971:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"go操作消息队列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go操作消息队列"}},[s._v("#")]),s._v(" Go操作消息队列")]),s._v(" "),t("p",[s._v("NSQ是目前比较流行的一个分布式的消息队列，本文主要介绍了NSQ及Go语言如何操作NSQ。")]),s._v(" "),t("p",[s._v("使用消息队列的主要目的，异步、解耦、削峰")]),s._v(" "),t("h2",{attrs:{id:"nsq介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq介绍"}},[s._v("#")]),s._v(" NSQ介绍")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://nsq.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("NSQ"),t("OutboundLink")],1),s._v("是Go语言编写的一个开源的实时分布式内存消息队列，其性能十分优异。 NSQ的优势有以下优势：")]),s._v(" "),t("ol",[t("li",[s._v("NSQ提倡分布式和分散的拓扑，没有单点故障，支持容错和高可用性，并提供可靠的消息交付保证")]),s._v(" "),t("li",[s._v("NSQ支持横向扩展，没有任何集中式代理。")]),s._v(" "),t("li",[s._v("NSQ易于配置和部署，并且内置了管理界面。")])]),s._v(" "),t("h2",{attrs:{id:"nsq的应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq的应用场景"}},[s._v("#")]),s._v(" NSQ的应用场景")]),s._v(" "),t("p",[s._v("通常来说，消息队列都适用以下场景。")]),s._v(" "),t("h3",{attrs:{id:"异步处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步处理"}},[s._v("#")]),s._v(" 异步处理")]),s._v(" "),t("p",[s._v("参照下图利用消息队列把业务流程中的非关键流程异步化，从而显著降低业务请求的响应时间。"),t("img",{attrs:{src:"images/nsq1.png",alt:"nsq应用场景1"}})]),s._v(" "),t("h3",{attrs:{id:"应用解耦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用解耦"}},[s._v("#")]),s._v(" 应用解耦")]),s._v(" "),t("p",[s._v("通过使用消息队列将不同的业务逻辑解耦，降低系统间的耦合，提高系统的健壮性。后续有其他业务要使用订单数据可直接订阅消息队列，提高系统的灵活性。"),t("img",{attrs:{src:"images/nsq2.png",alt:"nsq应用场景1"}})]),s._v(" "),t("h3",{attrs:{id:"流量削峰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流量削峰"}},[s._v("#")]),s._v(" 流量削峰")]),s._v(" "),t("p",[s._v("类似秒杀（大秒）等场景下，某一时间可能会产生大量的请求，使用消息队列能够为后端处理请求提供一定的缓冲区，保证后端服务的稳定性。"),t("img",{attrs:{src:"images/nsq3.png",alt:"nsq应用场景1"}})]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://nsq.io/deployment/installing.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方下载页面"),t("OutboundLink")],1),s._v("根据自己的平台下载并解压即可。")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/image-20200901105947668.png",alt:"image-20200901105947668"}})]),s._v(" "),t("h2",{attrs:{id:"nsq组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq组件"}},[s._v("#")]),s._v(" NSQ组件")]),s._v(" "),t("h3",{attrs:{id:"nsqd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsqd"}},[s._v("#")]),s._v(" nsqd")]),s._v(" "),t("p",[s._v("nsqd是一个守护进程，它接收、排队并向客户端发送消息。")]),s._v(" "),t("p",[s._v("启动"),t("code",[s._v("nsqd")]),s._v("，指定"),t("code",[s._v("-broadcast-address=127.0.0.1")]),s._v("来配置广播地址")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nsqd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("broadcast"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果是在搭配"),t("code",[s._v("nsqlookupd")]),s._v("使用的模式下需要还指定"),t("code",[s._v("nsqlookupd")]),s._v("地址:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./nsqd -broadcast-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -lookupd-tcp-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4160\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("最后我们还需要启动图形化的界面 nsqadmin")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nsqadmin -lookupd-http-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4161\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后在启动成功后，在浏览器输入 127.0.0.1:4171，即可进入图形化界面")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/image-20200901125118515.png",alt:"image-20200901125118515"}})]),s._v(" "),t("p",[s._v("如果是部署了多个"),t("code",[s._v("nsqlookupd")]),s._v("节点的集群，那还可以指定多个"),t("code",[s._v("-lookupd-tcp-address")]),s._v("。")]),s._v(" "),t("p",[t("code",[s._v("nsqdq")]),s._v("相关配置项如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to query auth server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("broadcast"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    address that will be registered with lookupd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("defaults to the OS hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PROSNAKES.local"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to config file\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to store disk"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("backed messages\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deflate\n    enable deflate feature negotiation "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client compression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e2e"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("processing"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("percentile value\n    message processing time percentiles "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("as float "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to track "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("can be specified multiple times or comma separated '"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.95")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e2e"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("processing"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("window"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("time duration\n    calculate end to end latency quantiles "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this duration of time "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 60s would only show quantile calculations from the past "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" seconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 10m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4151"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP connect "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP request "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 5s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTPS clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4152"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    log message prefix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqd] "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lookupd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tcp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    lookupd TCP address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum size of a single command body "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("per"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of bytes per diskqueue file before rolling "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deflate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("level "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    max deflate compression level a client can negotiate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" values "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nsqd CPU usage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("heartbeat"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval duration\n    maximum client configurable duration of time between client heartbeats "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum size of a single message in bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum duration before a message will timeout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 15m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum client configurable size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a client output buffer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum client configurable duration of time between flushing to a client "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rdy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum RDY count "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a client "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum requeuing timeout "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a message "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1h0m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mem"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of messages to keep in memory "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("per topic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    duration to wait before auto"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("requeing a message "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1m0s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    unique part "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" message IDs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" in "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" is hash of hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("616")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("snappy\n    enable snappy feature negotiation "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client compression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    UDP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" of a statsd daemon "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" pushing stats\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    duration between pushing to statsd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1m0s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mem"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stats\n    toggle sending memory and GC stats to statsd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    prefix used "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keys sent to statsd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" host replacement"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nsq.%s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sync"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("every "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of messages per diskqueue fsync "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sync"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    duration of time per diskqueue fsync "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tcp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" TCP clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4150"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate file\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("policy "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    client certificate auth policy "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'require'")]),s._v(" or 'require"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verify'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to key file\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("min"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version value\n    minimum SSL"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TLS version acceptable "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'ssl3.0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.2'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("769")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("required\n    require TLS "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" client connections "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate authority file\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verbose\n    enable verbose logging\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("print")]),s._v(" version "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("worker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id\n    do NOT use this"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br")])]),t("h3",{attrs:{id:"nsqlookupd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsqlookupd"}},[s._v("#")]),s._v(" nsqlookupd")]),s._v(" "),t("p",[s._v("nsqlookupd是维护所有nsqd状态、提供服务发现的守护进程。它能为消费者查找特定"),t("code",[s._v("topic")]),s._v("下的nsqd提供了运行时的自动发现服务。 它不维持持久状态，也不需要与任何其他nsqlookupd实例协调以满足查询。因此根据你系统的冗余要求尽可能多地部署"),t("code",[s._v("nsqlookupd")]),s._v("节点。它们消耗的资源很少，可以与其他服务共存。我们的建议是为每个数据中心运行至少3个集群。")]),s._v(" "),t("p",[t("code",[s._v("nsqlookupd")]),s._v("相关配置项如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("-broadcast-address string\n    address of this lookupd node, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default to the OS "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PROSNAKES.local"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" string\n    path to config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n-http-address string\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4161"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-inactive-producer-timeout duration\n    duration of "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" a producer will remain "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the active list since its last "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 5m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-log-prefix string\n    log message prefix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqlookupd] "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-tcp-address string\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" TCP clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4160"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-tombstone-lifetime duration\n    duration of "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" a producer will remain tombstoned "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" registration remains "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 45s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-verbose")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" verbose logging\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version")]),s._v("\n    print version string\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"nsqadmin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsqadmin"}},[s._v("#")]),s._v(" nsqadmin")]),s._v(" "),t("p",[s._v("一个实时监控集群状态、执行各种管理任务的Web管理平台。 启动"),t("code",[s._v("nsqadmin")]),s._v("，指定"),t("code",[s._v("nsqlookupd")]),s._v("地址:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./nsqadmin -lookupd-http-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4161\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们可以使用浏览器打开"),t("code",[s._v("http://127.0.0.1:4171/")]),s._v("访问如下管理界面。"),t("img",{attrs:{src:"images/nsqadmin0.png",alt:"nsqadmin管理界面"}})]),s._v(" "),t("p",[t("code",[s._v("nsqadmin")]),s._v("相关的配置项如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    A CIDR from which to allow HTTP requests to the "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config endpoint "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1/8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to config file\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("graphite"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("url "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    graphite HTTP address\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4171"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP connect "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP request "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 5s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate file "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("insecure"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("skip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verify\n    configure the HTTP client to skip verification of TLS certificates\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to key file "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to CA file "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    log message prefix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqadmin] "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lookupd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    lookupd HTTP address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("notification"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("endpoint "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    HTTP endpoint "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fully qualified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to which POST notifications of admin actions will be sent\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nsqd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    nsqd HTTP address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("graphite\n    proxy HTTP requests to graphite\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("counter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    The counter stats key formatting applied by the implementation of statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" If no formatting is desired"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" set this to an empty "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stats.counters.%s.count"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("gauge"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    The gauge stats key formatting applied by the implementation of statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" If no formatting is desired"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" set this to an empty "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stats.gauges.%s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval duration\n    time interval nsqd is configured to push to statsd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("must match nsqd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    prefix used "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keys sent to statsd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" host replacement"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" must match nsqd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nsq.%s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("print")]),s._v(" version "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("h2",{attrs:{id:"nsq架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq架构"}},[s._v("#")]),s._v(" NSQ架构")]),s._v(" "),t("h3",{attrs:{id:"nsq工作模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq工作模式"}},[s._v("#")]),s._v(" NSQ工作模式")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/nsq4.png",alt:"nsq架构设计"}})]),s._v(" "),t("h3",{attrs:{id:"topic和channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#topic和channel"}},[s._v("#")]),s._v(" Topic和Channel")]),s._v(" "),t("p",[s._v("每个nsqd实例旨在一次处理多个数据流。这些数据流称为"),t("code",[s._v("“topics”")]),s._v("，一个"),t("code",[s._v("topic")]),s._v("具有1个或多个"),t("code",[s._v("“channels”")]),s._v("。每个"),t("code",[s._v("channel")]),s._v("都会收到"),t("code",[s._v("topic")]),s._v("所有消息的副本，实际上下游的服务是通过对应的"),t("code",[s._v("channel")]),s._v("来消费"),t("code",[s._v("topic")]),s._v("消息。")]),s._v(" "),t("p",[t("code",[s._v("topic")]),s._v("和"),t("code",[s._v("channel")]),s._v("不是预先配置的。"),t("code",[s._v("topic")]),s._v("在首次使用时创建，方法是将其发布到指定"),t("code",[s._v("topic")]),s._v("，或者订阅指定"),t("code",[s._v("topic")]),s._v("上的"),t("code",[s._v("channel")]),s._v("。"),t("code",[s._v("channel")]),s._v("是通过订阅指定的"),t("code",[s._v("channel")]),s._v("在第一次使用时创建的。")]),s._v(" "),t("p",[t("code",[s._v("topic")]),s._v("和"),t("code",[s._v("channel")]),s._v("都相互独立地缓冲数据，防止缓慢的消费者导致其他"),t("code",[s._v("chennel")]),s._v("的积压（同样适用于"),t("code",[s._v("topic")]),s._v("级别）。")]),s._v(" "),t("p",[t("code",[s._v("channel")]),s._v("可以并且通常会连接多个客户端。假设所有连接的客户端都处于准备接收消息的状态，则每条消息将被传递到随机客户端。例如：")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/nsq5.gif",alt:"nsq架构设计"}}),s._v("总而言之，消息是从"),t("code",[s._v("topic -> channel")]),s._v("（每个channel接收该topic的所有消息的副本）多播的，但是从"),t("code",[s._v("channel -> consumers")]),s._v("均匀分布（每个消费者接收该channel的一部分消息）。")]),s._v(" "),t("h3",{attrs:{id:"nsq接收和发送消息流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq接收和发送消息流程"}},[s._v("#")]),s._v(" NSQ接收和发送消息流程")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/nsq6.png",alt:"nsq架构设计"}})]),s._v(" "),t("ul",[t("li",[s._v("input Chan：就是go语言中的通道")]),s._v(" "),t("li",[s._v("In-Memory Chan：是内存的通道，负责将消息进行持久化")]),s._v(" "),t("li",[s._v("Output Chan：")])]),s._v(" "),t("h2",{attrs:{id:"nsq特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsq特性"}},[s._v("#")]),s._v(" NSQ特性")]),s._v(" "),t("ul",[t("li",[s._v("消息默认不持久化，可以配置成持久化模式。nsq采用的方式时内存+硬盘的模式，当内存到达一定程度时就会将数据持久化到硬盘。\n"),t("ul",[t("li",[s._v("如果将"),t("code",[s._v("--mem-queue-size")]),s._v("设置为0，所有的消息将会存储到磁盘。")]),s._v(" "),t("li",[s._v("服务器重启时也会将当时在内存中的消息持久化。")])])]),s._v(" "),t("li",[s._v("每条消息至少传递一次。")]),s._v(" "),t("li",[s._v("消息不保证有序。")])]),s._v(" "),t("h2",{attrs:{id:"go操作nsq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go操作nsq"}},[s._v("#")]),s._v(" Go操作NSQ")]),s._v(" "),t("p",[s._v("官方提供了Go语言版的客户端："),t("a",{attrs:{href:"https://github.com/nsqio/go-nsq",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-nsq"),t("OutboundLink")],1),s._v("，更多客户端支持请查看"),t("a",{attrs:{href:"https://nsq.io/clients/client_libraries.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CLIENT LIBRARIES"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("p",[s._v("首先进入bin目录下，打开cmd，输入")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nsqlookupd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后就开启了nsq服务，端口号是4160")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/image-20200901110859477.png",alt:"image-20200901110859477"}})]),s._v(" "),t("p",[s._v("然后我们在启动一个cmd界面，输入下面的代码，启动nsqd，nsqd是一个守护进程，它用于接收、排队并向客户端发送消息，启动nsqd，指定 "),t("code",[s._v("-broadcast-address=127.0.0.1")]),s._v(" 来配置广播地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nsqd -broadcast-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果是在搭配 "),t("code",[s._v("nsqlookupd")]),s._v("，使用的模式下需要还指定"),t("code",[s._v("nsqlookupd")]),s._v("的地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nsqd -broadcast-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -lookupd-tcp-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4160\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动成功的图片如下所示")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/image-20200901111133414.png",alt:"image-20200901111133414"}})]),s._v(" "),t("h3",{attrs:{id:"安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("go get "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" github.com/nsqio/go-nsq\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"生产者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产者"}},[s._v("#")]),s._v(" 生产者")]),s._v(" "),t("p",[s._v("一个简单的生产者示例代码如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nsq_producer/main.go")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bufio"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"strings"')]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/nsqio/go-nsq"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NSQ Producer Demo")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" producer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Producer\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化生产者")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initProducer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconfig "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tproducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewProducer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create producer failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" err\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tnsqAddress "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:4150"')]),s._v("\n\terr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initProducer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nsqAddress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"init producer failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\treader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" bufio"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewReader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Stdin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从标准输入读取")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" reader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ReadString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'\\n'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read string from stdin failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\tdata "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" strings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrimSpace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" strings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ToUpper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Q"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输入Q退出")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 向 'topic_demo' publish 数据")]),s._v("\n\t\terr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Publish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_demo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"publish msg to nsq failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("p",[s._v("将上面的代码编译执行，然后在终端输入两条数据"),t("code",[s._v("123")]),s._v("和"),t("code",[s._v("456")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./nsq_producer \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":41:20 INF    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" connecting to nsqd\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("使用浏览器打开"),t("code",[s._v("http://127.0.0.1:4171/")]),s._v("可以查看到类似下面的页面： 在下面这个页面能看到当前的"),t("code",[s._v("topic")]),s._v("信息："),t("img",{attrs:{src:"images/nsqadmin1.png",alt:"nsqadmin界面1"}})]),s._v(" "),t("p",[s._v("点击页面上的"),t("code",[s._v("topic_demo")]),s._v("就能进入一个展示更多详细信息的页面，在这个页面上我们可以查看和管理"),t("code",[s._v("topic")]),s._v("，同时能够看到目前在"),t("code",[s._v("LWZMBP:4151 (127.0.01:4151)")]),s._v("这个"),t("code",[s._v("nsqd")]),s._v("上有2条message。又因为没有消费者接入所以暂时没有创建"),t("code",[s._v("channel")]),s._v("。"),t("img",{attrs:{src:"images/nsqadmin2.png",alt:"nsqadmin界面2"}})]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("/nodes")]),s._v("这个页面我们能够很方便的查看当前接入"),t("code",[s._v("lookupd")]),s._v("的"),t("code",[s._v("nsqd")]),s._v("节点。"),t("img",{attrs:{src:"images/nsqadmin3.png",alt:"nsqadmin界面3"}})]),s._v(" "),t("p",[s._v("这个"),t("code",[s._v("/counter")]),s._v("页面显示了处理的消息数量，因为我们没有接入消费者，所以处理的消息数量为0。![images/nsqadmin4.png)")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("/lookup")]),s._v("界面支持创建"),t("code",[s._v("topic")]),s._v("和"),t("code",[s._v("channel")]),s._v("。"),t("img",{attrs:{src:"images/nsqadmin5.png",alt:"nsqadmin界面5"}})]),s._v(" "),t("h3",{attrs:{id:"消费者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消费者"}},[s._v("#")]),s._v(" 消费者")]),s._v(" "),t("p",[s._v("一个简单的消费者示例代码如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nsq_consumer/main.go")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os/signal"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"syscall"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/nsqio/go-nsq"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NSQ Consumer Demo")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MyHandler 是一个消费者类型")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" MyHandler "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tTitle "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// HandleMessage 是需要实现的处理消息的方法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("MyHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s recv from %v, msg:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Title"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NSQDAddress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化消费者")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initConsumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" address "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconfig "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LookupdPollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second\n\tc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConsumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create consumer failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tconsumer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MyHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tTitle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"沙河1号"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("AddHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// if err := c.ConnectToNSQD(address); err != nil { // 直接连NSQD")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ConnectToNSQLookupd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("address"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过lookupd查询")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" err\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\terr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initConsumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_demo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"first"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:4161"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"init consumer failed, err:%v\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("chan")]),s._v(" os"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Signal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义一个信号的通道")]),s._v("\n\tsignal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" syscall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SIGINT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转发键盘中断信号到c")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v("c                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 阻塞")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br")])]),t("p",[s._v("将上面的代码保存之后编译执行，就能够获取之前我们publish的两条消息了：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./nsq_consumer \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":49:06 INF    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic_demo/first"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" querying nsqlookupd http://127.0.0.1:4161/lookup?topic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("topic_demo\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":49:06 INF    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic_demo/first"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" connecting to nsqd\n沙河1号 recv from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150, msg:123\n沙河1号 recv from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150, msg:456\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("同时在nsqadmin的"),t("code",[s._v("/counter")]),s._v("页面查看到处理的数据数量为2。"),t("img",{attrs:{src:"images/nsqadmin6.png",alt:"nsqadmin界面5"}})]),s._v(" "),t("p",[s._v("关于"),t("code",[s._v("go-nsq")]),s._v("的更多内容请阅读"),t("a",{attrs:{href:"https://godoc.org/github.com/nsqio/go-nsq",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-nsq的官方文档"),t("OutboundLink")],1),s._v("。")])])}),[],!1,null,null,null);t.default=e.exports}}]);